## pandas库学习(1月25日)

### 一.学习内容

* 初步学习读取数据
* 简单的数据清洗

### 二.学习笔记

#### 1.Series结构

一维带标签数组（索引index&值values）

##### （1）创建

###### ①常规创建

~~~
import pandas as pd
s = pd.Series(data, index, dtype, copy)
~~~

| 参数  | 说明                              |
| ----- | --------------------------------- |
| data  | 输入的数据                        |
| index | 规定索引值，默认为0开始的递增整数 |
| dtype | 数据类型，不规定则默认为自动识别  |
| copy  | 是否复制data，默认为False         |

~~~
t1 = pd.Series([1, 2, 3, 4, 5])
'''
0    1
1    2
2    3
3    4
dtype: int64
'''

t2 = pd.Series([1, 2, 3, 4, 5], index=list('abcde'))
'''
a    1
b    2
c    3
d    4
e    5
dtype: int64
'''

t3 = pd.Series([1, 2, 3, 4, 5], dtype='float64')
'''
0    1.0
1    2.0
2    3.0
3    4.0
4    5.0
dtype: float64
'''

t6 = pd.Series(np.arange(5), index=list(string.ascii_lowercase[:5]))
'''
a    0
b    1
c    2
d    3
e    4
dtype: int32
'''
~~~

* 修改数字类型

`.astype(数字类型)`

```
t2 = t2.astype(float)
'''
a    1.0
b    2.0
c    3.0
d    4.0
e    5.0
dtype: float64
'''
```

###### ②字典创建

~~~
tmp_dict1 = {"name":"xxx", "age":18, "school":"GDUT" }
t4 = pd.Series(tmp_dict1)
'''
name       xxx
age         18
school    GDUT
dtype: object
'''

import string
tmp_dict2 = {string.ascii_uppercase[i]:i for i in range(10)}	# 推导式创建 大写字母对应其顺序
t5 = pd.Series(tmp_dict2)
'''
A    0
B    1
C    2
D    3
E    4
F    5
G    6
H    7
I    8
J    9
dtype: int64
'''
~~~

##### （2）查找

###### ①索引

~~~
'''
t4 -->
name       xxx
age         18
school    GDUT
dtype: object
'''

# 按索引名称
print(t4['age'])		# 18

# 按索引行
print(t4[0])			# 'xxx'

# 一次取多个
print(t4[[0,2]])
'''
name       xxx
school    GDUT
dtype: object
'''
print(t4[['age','school']])
'''
age         18
school    GDUT
dtype: object
'''
~~~

如果输入了不存在的索引，要么报错，要么输出NaN

###### ②范围

~~~
'''
t5 -->
A    0
B    1
C    2
D    3
E    4
F    5
G    6
H    7
I    8
J    9
dtype: int64
'''
print(t5[t5>5])
'''
G    6
H    7
I    8
J    9
dtype: int64
'''
~~~

##### （3）读取外部数据

###### ①语法

`.read_csv('文件路径')`

还可以从别的地方读excel、剪贴板...

简单示例：

~~~
x = pd.read_csv('./xxx.csv')
print(x)
~~~

#### 2.DataFrame结构

##### （1）创建

~~~
import pandas as pd
pd.DataFrame( data, index, columns, dtype, copy)
~~~

| 参数    | 说明                          |
| ------- | ----------------------------- |
| data    | 输入的数据                    |
| index   | 行标签，默认为0开始的递增整数 |
| columns | 列标签，默认为0开始的递增整数 |
| dtype   | 每一列的数据类型              |
| copy    | 复制data，默认为False         |

###### ①常规创建

~~~
t1 = pd.DataFrame(np.arange(12).reshape(3,4))
'''
   0  1   2   3		# 1轴  columns
0  0  1   2   3
1  4  5   6   7
2  8  9  10  11
0轴  index
'''

t2 = pd.DataFrame(np.arange(12).reshape(3,4), index=list('abc'), columns=list('wxyz'))
'''
   w  x   y   z
a  0  1   2   3
b  4  5   6   7
c  8  9  10  11
'''
~~~

###### ②字典创建

~~~
d1 = {'name':['xxx', 'yyy'], 'age':[18, 19], 'school':['SZSH', 'GDUT']}
t1 = pd.DataFrame(d1)
'''
  name  age school
0  xxx   18   SZSH
1  yyy   19   GDUT
''' 

d2 = [ {'name':"xxx", 'age':18, 'school':'SZSH'}, {'name':"yyy", 'age':19, 'school':'GDUT'}, {'name':"zzz", 'age':20, 'school':'GDUT'}]
t2 = pd.DataFrame(d2)
'''
  name  age school
0  xxx   18   SZSH
1  yyy   19   GDUT
2  zzz   20   GDUT
'''

# 嵌套列表
data = [['Alex',10],['Bob',12],['Clarke',13]]
t3 = pd.DataFrame(data,columns=['Name','Age'])


~~~

如果没有找到对应的值的话，为NaN

###### ③Series创建

~~~
d3 = {'one' : pd.Series([1, 2, 3], index=['a', 'b', 'c']),
   'two' : pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])}
t3 = pd.DataFrame(d3)
'''
   one  two
a  1.0    1
b  2.0    2
c  3.0    3
d  NaN    4
'''
~~~

##### （2）操作

###### ①列

* 查找

~~~
print(t3['one'])		# Name: one, dtype: float64
~~~

* 添加

~~~
# 列索引添加
d4 = {'one' : pd.Series([1, 2, 3], index=['a', 'b', 'c']),
   'two' : pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])}
t4 = pd.DataFrame(d4)
d4['three'] = pd.Series([10, 20, 30], index=['a', 'b', 'c'])

# 函数添加
# .insert( 插入的索引位置， column='列索引名'， value=[data])
t4.insert(0, column='zero', value=[5,4,3,2])

'''
   zero  one  two  three
a     5  1.0    1   10.0
b     4  2.0    2   20.0
c     3  3.0    3   30.0
d     2  NaN    4    NaN
'''
~~~

* 运算

~~~
d4['four'] = d4['one'] + d4['three']
'''
   one  two  three  four
a  1.0    1   10.0  11.0
b  2.0    2   20.0  22.0
c  3.0    3   30.0  33.0
d  NaN    4    NaN   NaN
'''
~~~

* 删除

  * `del`

    ~~~
    del t4['three']
    '''
       zero  one  two  four
    a     5  1.0    1  11.0
    b     4  2.0    2  22.0
    c     3  3.0    3  33.0
    d     2  NaN    4   NaN
    '''
    ~~~

  * `pop()`

    ~~~
    t4.pop('two')
    '''
       zero  one  four
    a     5  1.0  11.0
    b     4  2.0  22.0
    c     3  3.0  33.0
    d     2  NaN   NaN
    '''
    ~~~

###### ②行

~~~
'''
t1 -->
   one  two  three  four
a  1.0    1   10.0  11.0
b  2.0    2   20.0  22.0
c  3.0    3   30.0  33.0
d  NaN    4    NaN   NaN
'''
~~~

* 查找

  * `loc()`

    只能标签索引

    ~~~
    print(t1.loc['b'])
    '''
    zero      4.0
    one       2.0
    two       2.0
    three    20.0
    four     22.0
    Name: b, dtype: float64
    '''
    ~~~

  * `iloc()`

    只能整数索引

    ~~~
    print(t1.iloc[2])
    '''
    zero      3.0
    one       3.0
    two       3.0
    three    30.0
    four     33.0
    Name: c, dtype: float64
    '''
    ~~~

  上面两个函数都可以接受两个参数，分别是行和列，用逗号隔开

* 添加

`drop(索引标签)`

~~~
t1 = pd.DataFrame([[1, 2], [3, 4], [5, 6]], columns = ['a','b'])
t1 = t1.drop(0)
print(t1)
'''
   a  b
1  3  4
2  5  6
'''
~~~

###### ③切片

`[start:end]`：start到end-1

~~~
d1 = { 'one':[1, 2, 3], 'two' = [4, 5, 6], 'three' = [7, 8, 9] }
t1 = pd.DataFrame(d1, columns='abc')
print(t1)
'''
   one  two  three
a    1    4      7
b    2    5      8
c    3    6      9
'''
print(t1[0:2])
'''
   one  two  three
a    1    4      7
b    2    5      8
'''
~~~

#### 3.数据清洗

##### （1）缺失值

###### ①检测缺失值

是否为空：`isna()`/`isnull()`

（是否不为空：`notna()`/`notnull()`）

* 用于判断一个Series或DataFrame各元素值是否为空
  * 结果为bool
  * None或NaN才算空，空列表、空字符串等不算

~~~
t1 = pd.Series(['x', 'y', np.nan, [], None, 'z'])
print(t1)
print(t1.isna())
~~~

打印结果：

~~~
0       x
1       y
2     NaN
3      []
4    None
5       z
dtype: object

0    False
1    False
2     True
3    False
4     True
5    False
dtype: bool
~~~

###### ②填充缺失值

Ⅰ常量填充

​	`fillna()`

~~~
t1 = pd.DataFrame(['x', 'y', np.nan, [], None, 'z'], columns=['info'])
t1 = t1[['info']].fillna('xx')
print(t1)
'''
0    x
1    y
2   xx
3   []
4   xx
5    z
'''
~~~

Ⅱ 向前和向后填充NA

* 向前填充：`fillna(method='ffill')`
  * 用前面的值来填充缺失值

* 向后填充：`fillna(method='bfill')`
  * 用后面的值来填充缺失值

~~~
t2 = pd.Series(['M', 'F', np.nan, 'F', 'M', None, 'M'])
t1['gender'] = t2
print(t1)
t1[['gender']].fillna(method='ffill')
print(t1)
~~~

打印结果：

~~~
  name gender
0    x      M
1    y      F
2   xx    NaN
3   []      F
4   xx      M
5    z   None
  name gender
0    x      M
1    y      F
2   xx    NaN
3   []      F
4   xx      M
5    z   None
~~~

###### ③删除缺失值

`dropna()`

* 默认为对0轴进行处理，即某一行中只要存在缺失值就会被删除
* 传入`how='all'`，只有某一行全部都是缺失值才会被删除

~~~
t1 = pd.DataFrame([[1, 2, 3], [4, 5, None], [7, None, 9], [None, None, None]])
print(t1)
print(t1.dropna())
print(t1.dropna(how='all'))
~~~

打印结果：

~~~
     0    1    2
0  1.0  2.0  3.0
1  4.0  5.0  NaN
2  7.0  NaN  9.0
3  NaN  NaN  NaN

     0    1    2
0  1.0  2.0  3.0

     0    1    2
0  1.0  2.0  3.0
1  4.0  5.0  NaN
2  7.0  NaN  9.0
~~~

##### （2）重复值

###### ①检测重复值

`duplicated()`

* 返回行索引的bool结果
* keep参数可以设置保留第一行或最后一行
  * e.g.:keep=first表示存在重复的多行时，首行被认为是合法的而可以保留

~~~
t1 = pd.DataFrame({'one': ['A', 'A', 'A', 'B', 'A', 'B', 'B'], 'two': [1, 1, 2, 3, 3, 4, 4]})
print(t1)
print(t1.duplicated())
print(t1.duplicated(keep='last'))
~~~

打印结果：

~~~
0   A    1
1   A    1
2   A    2
3   B    3
4   A    3
5   B    4
6   B    4

0    False
1     True
2    False
3    False
4    False
5    False
6     True
dtype: bool

0     True
1    False
2    False
3    False
4    False
5     True
6     True
7    False
dtype: bool
~~~

###### ②删除重复值

`drop_duplicates()`

~~~
print(t1.drop_duplicates())
print(t1.drop_duplicates(keep='last'))
~~~

打印结果：

~~~
  one  two
0   A    1
2   A    2
3   B    3
4   A    3
5   B    4

  one  two
1   A    1
2   A    2
3   B    3
4   A    3
7   B    4
~~~

##### （3）异常值

###### ①判断异常值

* 以大于或小于某个基线范围的值为标准

例：生成一个含有正态分布的DataFrame数据集

~~~
t1 = pd.DataFrame(np.random.randn(1000,4))
print(t1.describe())
~~~

~~~
                 0            1            2            3
count  1000.000000  1000.000000  1000.000000  1000.000000
mean      0.005573     0.010159     0.043500     0.028300
std       1.039570     0.945596     1.032513     0.936585
min      -3.664351    -3.168724    -3.970196    -2.789822
25%      -0.697584    -0.581457    -0.647751    -0.603478
50%       0.011714     0.008367     0.042354     0.008690
75%       0.678373     0.646077     0.751672     0.719132
max       3.180186     2.784923     2.794035     2.774431
~~~

* 假设认为某列中绝对值大小超过3的是异常值

~~~
print(t1[np.abs(t1[1])>3])
~~~

~~~
            0         1         2         3
852 -0.648826  3.100169 -0.026738 -0.715397
950  0.519965  3.211694  1.265718  0.656131
992  0.630562  3.662054  1.587911 -0.237910
~~~

* 找出全部含有绝对值大小超过3的行

~~~
print(t1[(np.abs(t1)>3).any(axis=1)])
~~~

~~~
            0         1         2         3
106  3.278259 -1.578321 -1.323142 -0.144558
433  0.727878 -1.602709  0.402089 -3.042510
492 -0.438015  3.371926 -0.225598 -0.327152
513  0.055012  3.072222 -1.543645  1.400822
525 -0.253071 -3.042726 -0.820449  0.219506
566  1.187794  0.902671 -3.286914 -0.347177
608 -0.927697  0.929606  3.224099 -0.779866
667  0.145472 -0.279381  1.177224  3.021470
~~~

###### ②替换异常值

* 将异常值替换成为绝对值不大于3的

~~~
t1[np.abs(t1)>3] = np.sign(t1)*3
~~~

~~~
            0         1         2         3
0    0.621292 -0.183581 -0.841123 -0.991548
1   -1.979245  0.388863 -0.150415  0.559336
2   -1.133534 -0.782968  0.680854 -1.838033
3   -1.195000 -0.570549 -0.486093 -1.164667
4   -0.417763  0.826619  1.135488 -0.808853
..        ...       ...       ...       ...
995 -0.210235 -1.856913  1.401590  2.089036
996  0.893787 -2.006542 -0.648272  0.818106
997 -0.469561  1.467678 -0.022062  0.275630
998 -0.077949 -0.794840  0.052269  1.932531
999  0.140132  1.765904 -0.241153 -2.409878
~~~

* 之后再重新检测

  ~~~
  print(t1[(np.abs(t1)>3).any(axis=1)])
  ~~~

  ~~~
  Empty DataFrame
  Columns: [0, 1, 2, 3]
  Index: []
  ~~~

###### ③删除异常值

`drop()`

例：删除第三列（列索引为2）中绝对值>3的行

~~~
col = t1[1]
print(t1[np.abs(col)>3])
t1.drop(t1[np.abs(col)>3].index,inplace=True)
~~~

~~~
            0         1         2         3
312 -1.627760  3.212540 -0.585442 -0.519364
326 -0.517918  3.608782  0.694440 -0.364833
382  1.941755 -3.030545 -0.554499  1.503736
572  0.342724  3.046400 -0.013255 -1.300366
765 -0.094723 -3.082264 -0.197779 -0.374388
955  0.775869  3.680041  0.390054 -1.618676

            0         1         2         3
0    1.124701 -0.056632 -0.254950 -1.535485
1   -0.381188 -0.181655 -0.446114 -0.593055
2   -0.515102  1.231487 -1.883941  0.181030
3    0.071677 -0.169495 -1.064850  2.434929
4    1.487117 -0.431607  0.973872 -1.135005
..        ...       ...       ...       ...
995 -1.219997  1.272044  0.035168 -1.153055
996 -0.130432  0.609571  0.187649  1.591669
997  0.585018  1.940632  1.138153 -0.974637
998 -0.029602 -0.176528 -0.988171 -0.399512
999 -1.572698  0.615292 -1.527283 -0.531456

[994 rows x 4 columns]
~~~

上面检测到某列有不符的行一共有6行，下方删除后剩996行