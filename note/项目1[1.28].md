## 泰坦尼克号数据集可视化

### 1.数据清洗

##### （1）导入数据，检查数据

~~~
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

train = pd.read_csv("D:/【Worksheet6】QG/QG_winter_camp/data/train.csv")

print(train.describe())
print(train.info())
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281629095.png)

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281629097.png)

* 得知一共有12项信息，其中年龄(Age)，座位号(Cabin)，登船地区(Embarked)信息有缺失

##### （2）填补缺失年龄

~~~
age_mean = train['Age'].mean()
print(age_mean)
train['Age'] = train['Age'].fillna(method='ffill')
~~~

* 年龄平均值为29.69911764705882，缺失177人年龄信息，全部填补为平均年龄后，年龄信息过分集中在25岁到30岁
* 故采取按缺失信息前一人年龄信息填补的方法，信息完善效果更好

##### （3）填补缺失登船地区

~~~
print(train['Embarked'].value_counts())
train['Embarked'] = train['Embarked'].fillna('S')
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281636103.png)

* 统计可知在英国南安普顿(S)登船的乘客数量最多，缺失2人登船地区信息
* 故按在英国南安普顿登船填补的方法，填补确实信息

##### （4）删除座位号信息

~~~
print(train['Cabin'].value_counts())
del train['Cabin']
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281901111.png)

* 座位号缺失的有687人，数量过大且座位号种类多
* 故删除座位号信息

##### （5）再次检查数据

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281904687.png)

无缺失信息

#### 2.数据可视化

##### （1）总体生还率

~~~
# 统计幸存和丧生数据
survived_total = train['Survived'].value_counts()
fig = plt.figure(figsize=(5,5), dpi=80)

print(survived_total)
'''
Survived
0    549
1    342
Name: count, dtype: int64
'''

plt.pie(survived_total, textprops=dict(size=12), explode=[0, 0.1], autopct='%.2f%%', labels=['丧生','幸存'], pctdistance=0.5, labeldistance=0.7, colors=['#6495ED', '#FFDEAD'])
plt.title('总体生还率')

plt.savefig("D:/pycharm/pics/titanic-pics/总体生还率.png")
plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281907745.png)

* 由图可见，泰坦尼克号沉船事件超过60%的乘客丧生，属于较为严重的海难

##### （2）幸存者性别比例

~~~
# 统计幸存者性别数量信息
survived_sex = train.groupby(by='Sex') ['Survived'].value_counts()
survived_sex_num = train.groupby(by='Sex')['Survived'].sum()
# 统计总体性别数量信息
sex = train['Sex'].value_counts()
sex_num = train['Sex'].sum()

print(sex)
'''
Sex
male      577
female    314
Name: count, dtype: int64
'''
print(survived_sex_num)
'''
Sex
female    233
male      109
Name: Survived, dtype: int64
'''

plt.figure(figsize=(15,5), dpi=80)
pie1 = plt.subplot(1, 3, 2)
pie2 = plt.subplot(1, 3, 3)
pie3 = plt.subplot(1, 3, 1)
pie1.pie(survived_sex.loc['female'], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#FFC1C1', '#FFF0F5'], startangle=45)
pie2.pie(survived_sex.loc['male'][::-1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#BFEFFF', '#E0FFFF'], startangle=150)
pie3.pie(sex, textprops=dict(size=12), explode=[0, 0.05], autopct='%.2f%%', labels=['男性', '女性'], pctdistance=0.5, labeldistance=0.7, colors=['#BFEFFF', '#FFC1C1'], startangle=60)
pie1.set_title('女性生还率')
pie2.set_title('男性生还率')
pie3.set_title('男女性别比')
plt.savefig("D:/pycharm/pics/titanic-pics/幸存男女比例饼图.png")
plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281916363.png)

~~~
plt.figure(figsize=(8,8), dpi=80)
bar_width = 0.4
bar_positions = range(2)
plt.bar(bar_positions, sex, width=bar_width, color=['#E0FFFF', '#FFF0F5'], label=['总人数 - 男性', '总人数 - 女性'])
plt.bar(bar_positions, survived_sex_num[::-1], width=bar_width, color=['#BFEFFF', '#FFC1C1'], label=['生还人数 - 男性', '生还人数 - 女性'])
plt.yticks(range(0,600,30))
plt.legend()
plt.xticks(bar_positions, labels=['男性', '女性'])
plt.savefig("D:/pycharm/pics/titanic-pics/幸存男女比例条形图.png")
# plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281925732.png)

* 由图可见，船上男性的数量接近女性数量的两倍，但是女性中幸存者接近75%，而男性幸存者不到20%且少于女性幸存者
* 救生艇有可能优先女性使用

##### （3）幸存者年龄比例

~~~
# 统计各年龄段总体人数
age = train['Age']
age_num = np.histogram(age, range=[0,80], bins=16)

# 统计各年龄段幸存者人数
survived_age_num = []
for n_age in range(5,81,5):
    num = train.loc[ (age >= n_age-5)&(age <= n_age) ]['Survived'].sum()
    survived_age_num.append(num)

print(age_num)
print(survived_age_num)


plt.figure(figsize=(10,5), dpi=80
plt.bar(np.arange(2,78,5)+0.5,age_num[0], width=5,label='总人数',alpha=0.8, color='#6495ED')
plt.bar(np.arange(2,78,5)+0.5,survived_age_num,width=5,label='生还人数', color='#FFDEAD')
plt.xticks(range(0,81,5))
plt.yticks(range(0,141,10))
plt.xlabel('年龄', fontsize=15)
plt.ylabel('人数', fontsize=15)
plt.title('各年龄阶段人数和生还人数条形图')
plt.grid(alpha=0.4)
plt.legend()
# plt.savefig("D:/pycharm/pics/titanic-pics/幸存年龄比例.png")
plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281929383.png)

* 由图可见，0到15岁的儿童和40岁以上的老年人幸存率均接近及超过50%
* 救生艇可能优先儿童和老人使用

##### （4）幸存者船舱等级比例

~~~
# 统计各船舱幸存者比例与总体比例
survived_pclass = train.groupby(by='Pclass')['Survived'].value_counts()
pclass = train['Pclass'].value_counts()
print(survived_pclass)
'''
Pclass  Survived
1       1           136
        0            80
2       0            97
        1            87
3       0           372
        1           119
Name: count, dtype: int64
'''

plt.figure(figsize=(20,5), dpi=80)
pie1 = plt.subplot(1, 4, 1)
pie2 = plt.subplot(1, 4, 2)
pie3 = plt.subplot(1, 4, 3)
pie4 = plt.subplot(1, 4, 4)
pie2.pie(survived_pclass.loc[1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#4C6E8C', '#B0C4DE'], startangle=65)
pie3.pie(survived_pclass.loc[2][::-1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#8A5288', '#D8BFD8'], startangle=95)
pie4.pie(survived_pclass.loc[3][::-1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#607C59', '#B0C985'], startangle=135)
pie1.pie(pclass, textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['一等舱乘客', '二等舱乘客', '三等舱乘客'], pctdistance=0.5, labeldistance=0.7, colors=['#4C6E8C', '#8A5288', '#607C59'], startangle=75)
pie1.set_title('不同船舱等级比例')
pie2.set_title('一等舱生还率')
pie3.set_title('二等舱生还率')
pie4.set_title('三等舱生还率')
# plt.savefig("D:/pycharm/pics/titanic-pics/不同船舱生还比例.png")
plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281943580.png)

* 由图可见，一等舱乘客幸存比例超过60%，而二等舱接近50%，三等舱不满25%
* 一等舱可能接近船体上部，而二、三等舱在中下部，一等舱更有利于逃生

##### （5）幸存者登船港口比例

~~~
# 统计各港口登船幸存者人数与总体人数
survived_embarked = train.groupby(by='Embarked')['Survived'].value_counts()
embarked = train['Embarked'].value_counts()
print(survived_embarked)
'''
Embarked  Survived
C         1            93
          0            75
Q         0            47
          1            30
S         0           427
          1           219
Name: count, dtype: int64
'''

plt.figure(figsize=(20,5), dpi=80)
pie1 = plt.subplot(1, 4, 1)
pie2 = plt.subplot(1, 4, 2)
pie3 = plt.subplot(1, 4, 3)
pie4 = plt.subplot(1, 4, 4)
pie2.pie(survived_embarked.loc['C'], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#A5682A', '#E0B979'], startangle=80)
pie3.pie(survived_embarked.loc['Q'][::-1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#8C6488', '#D8BFD8'], startangle=110)
pie4.pie(survived_embarked.loc['S'][::-1], textprops=dict(size=12), explode=[0, 0.12], autopct='%.2f%%', labels=['幸存', '丧生'], pctdistance=0.5, labeldistance=0.7, colors=['#997A41', '#E6D59F'], startangle=120)
pie1.pie(embarked, textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['法国瑟堡市乘客', '爱尔兰昆士敦乘客', '英国南安普顿乘客'], pctdistance=0.5, labeldistance=0.7, colors=['#A5682A', '#8C6488', '#997A41'], startangle=45)
pie1.set_title('各港口登船比例')
pie2.set_title('法国瑟堡市乘客登船生还率')
pie3.set_title('爱尔兰昆士敦乘客登船生还率')
pie4.set_title('英国南安普顿乘客登船生还率')
# plt.savefig("D:/pycharm/pics/titanic-pics/不同港口幸存比例.png")
# plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281940528.png)

##### （6）各登船口乘客船舱选择比例

~~~
# 统计各船舱登船者来自的港口
embarked_pclass = train.groupby(by='Embarked')['Pclass'].value_counts()
print(embarked_pclass)
'''
Embarked  Pclass
C         1          85
          3          66
          2          17
Q         3          72
          2           3
          1           2
S         3         353
          2         164
          1         129
Name: count, dtype: int64
'''

plt.figure(figsize=(20,5), dpi=80)
pie1 = plt.subplot(1, 4, 1)
pie2 = plt.subplot(1, 4, 2)
pie3 = plt.subplot(1, 4, 3)
pie4 = plt.subplot(1, 4, 4)
pie2.pie(embarked_pclass.loc['C'], textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['一等舱', '二等舱', '三等舱'], pctdistance=0.5, labeldistance=0.7, colors=['#A5682A', '#D4B999', '#EFD8C6'], startangle=90)
pie3.pie(embarked_pclass.loc['Q'][::-1], textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['一等舱', '二等舱', '三等舱'], pctdistance=0.5, labeldistance=0.7, colors=['#8C6488', '#C6B2CC', '#E8D4E6'], startangle=350)
pie4.pie(embarked_pclass.loc['S'][::-1], textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['一等舱', '二等舱', '三等舱'], pctdistance=0.5, labeldistance=0.7, colors=['#997A41', '#D8C88A', '#EFE5C1'], startangle=100)
pie1.pie(embarked, textprops=dict(size=12), explode=[0.05, 0.05, 0.05], autopct='%.2f%%', labels=['法国瑟堡市乘客', '爱尔兰昆士敦乘客', '英国南安普顿乘客'], pctdistance=0.5, labeldistance=0.7, colors=['#A5682A', '#8C6488', '#997A41'], startangle=45)
pie1.set_title('各港口登船比例')
pie2.set_title('法国瑟堡市乘客登船生还率')
pie3.set_title('爱尔兰昆士敦乘客登船生还率')
pie4.set_title('英国南安普顿乘客登船生还率')
plt.savefig("D:/pycharm/pics/titanic-pics/不同地区登船船舱比例.png")
# plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281948982.png)

* 由图可见法国登船乘客接近3/4，且选择一等舱的超过50%；来自爱尔兰港口的乘客不到20%，且超过90%选择三等舱；来自英国的乘客不到10%，且超过50%选择了三等舱
* 由此可见可能当时法国经济发展状况最好，英国其次，再是爱尔兰
* 同时也可解释法国登船乘客幸存率最高的原因，法国绝大多数乘客选择的是较好的船舱

##### （7）幸存者经济水平比例

~~~
# 统计不同票价幸存者人数与总人数
fare_count = train.groupby(by='Fare')['Survived'].value_counts()
fare_count = pd.DataFrame(fare_count)
fare_count.rename(columns={'Survived':'count'},inplace=True)
fare_count.reset_index(inplace=True)
print(fare_count)
'''
         Fare  Survived  count
0      0.0000         0     14
1      0.0000         1      1
2      4.0125         0      1
3      5.0000         0      1
4      6.2375         0      1
..        ...       ...    ...
325  247.5208         1      1
326  262.3750         1      2
327  263.0000         0      2
328  263.0000         1      2
329  512.3292         1      3

[330 rows x 3 columns]
'''

# 统计不同票价乘客总人数
fare_num = fare_count.groupby(by='Fare')['count'].sum()
fare_num = pd.DataFrame(fare_num)
fare_num.rename(columns={'count':'Total'},inplace=True)
print(fare_num)
'''
          Total
Fare           
0.0000       15
4.0125        1
5.0000        1
6.2375        1
6.4375        1
...         ...
227.5250      4
247.5208      2
262.3750      2
263.0000      4
512.3292      3

[248 rows x 1 columns]
'''

# 分别统计不同票价幸存者人数与死亡人数
fare_survived = fare_count.loc[fare_count['Survived']==1]
fare_survived = fare_survived.merge(fare_num,left_on='Fare',right_index=True,how='inner')
fare_death = fare_count.loc[fare_count['Survived']==0]
fare_death = fare_death.merge(fare_num,left_on='Fare',right_index=True,how='inner')

# 由幸存和死亡人数与乘客总人数计算不同票价的幸存比与死亡比
survived_rate = fare_survived['count'].div(fare_survived['Total'])
survived_rate.index = fare_survived['Fare']
death_rate = fare_death['count'].div(fare_death['Total'])
death_rate.index = fare_death['Fare']


plt.figure(figsize=(20,5), dpi=80)
sct1 = plt.subplot(1, 2, 1)
sct2 = plt.subplot(1, 2, 2)
sct1.scatter(survived_rate.index,survived_rate,marker='o',color='r')
x_list = [i for i in range(0, 520, 20)]
y_list = [i/10 for i in range(11)]
sct1.set_xticks(x_list)
sct1.set_yticks(y_list)
sct1.set_xlabel('票价', fontsize=15)
sct1.set_ylabel('生还率', fontsize=15)
plt.title('各年龄阶段人数和生还人数条形图')
sct1.set_title('乘客生还率和票价关系散点图')
sct2.scatter(death_rate.index,death_rate,marker='^',color='b')
sct2.set_title('乘客死亡率和票价关系散点图')
sct2.set_xticks(x_list)
sct2.set_yticks(y_list)
sct2.set_xlabel('票价', fontsize=15)
sct2.set_ylabel('死亡率', fontsize=15)
plt.savefig("D:/pycharm/pics/titanic-pics/不同票价幸存率分布.png")
plt.show()
~~~

![](https://sevanthea7.oss-cn-beijing.aliyuncs.com/QGworks/202401281958721.png)

* 票价较高的生还率接近100%，而低票价的生还率情况不定且总体死亡率较高